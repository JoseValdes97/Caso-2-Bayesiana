---
title: "Caso 2(Principal)"
author: "Joan Lamprea y Jose Valdes"
date: "2023-05-04"
output: html_document
---

```{r setup, include=FALSE}
suppressMessages(suppressWarnings(library(dplyr)))
knitr::opts_chunk$set(echo = TRUE)
```

# Caso 2 de bayesiana

## Base de datos

```{r}
# cargar los datos
load("Personas.Rdata")
# mira Na en ingtot
sum(is.na(dat$ingtot))
```
Teniendo en cuenta lo anterior extraeremos de la base de datos las variables
para el caso las cuales son **dominio** y **ingtot**. Organizamos los datos
teniendo en cuenta que:  

 1. Recordamos que la funci蚤 log tiene base $e$.  
 2. La variable **dominio** es un factor 

```{r}
#datos que voy a usar
Data <- data.frame(dat$dominio, dat$ingtot)
#nombres
names(Data) <- c("Dominio","Ingtot")
# pasamos los Ingtot a escala logaritmica
Data[,2] <- log(Data$Ingtot)
# presentar datos
head(Data)
# comprobar media,varianza  y precisi칩n
mean(Data$Ingtot)
var(Data$Ingtot)
1/var(Data$Ingtot)
# volver factor domionio
class(Data$Dominio)
Data[,1] <- as.factor(Data$Dominio)
summary(Data$Dominio)
```

Ahora con esto obtendremos los datos que nos son relevantes para eltrabajo  
desde la base de datos como:

```{r}
# m <- Cantidad de dominios (Departamentos)
m <- length(table(Data$Dominio))
m
# n <- n칰mero de individuos
n <- sum(table(Data$Dominio))
n
# y <- vector con los datos
y <- Data$Ingtot
head(y)
```

Obtendremos una tabla con los estad押ticos necesarios por dominio para trabajar con las distribuciones condicionales completas y tener una idea de los datos.

 1. la funci蚤 **n()** solo funciona dentro de una funci蚤 actual como summarise     en el estado actual y devuelve el tama絪 del grupo

```{r}
# tabla con los estadisticos
Estadisticos <- Data %>% 
      group_by(Dominio) %>% 
      summarise(Dominio = unique(Dominio), nj = n(), yb = mean(Ingtot),
                s2 = var(Ingtot))
head(Estadisticos)
# almacenar info importante
nj <- Estadisticos$nj
yb <- Estadisticos$yb
s2 <- Estadisticos$s2
```

## Modelo 1

Hipepar炅etros del modelo.
$\textsf{M}_2$: $\mu_0 = 13.495$, $\gamma_0^2 = 11.382$, $\nu = 1$ y $\sigma^2_0=1.182$.

Ejecuci蚤 del modelo

```{r}
#ajustar modelo
tictoc::tic()
set.seed(1856)
cadena1_M1 <- MCMC_1(y,B = 11000)
tictoc::toc()
```

### Convergencia

Usaremos la log-verosimilitud para mirar la convergencia de la cadena

```{r}
# cadenas
col <- RColorBrewer::brewer.pal(9,"Set1")[1:9]
yrange <- range(cadena1_M1$LL$ll)
# Gr치fico
plot(cadena1_M1$LL$ll, type = "p", pch = ".", cex = 1.1, col = col[2], ylim = yrange, xlab = "Iteraci蚤", ylab = "Log-verosimilitud", main = "Modelo 1")
```

## Modelo 2

Hipepar炅etros del modelo.
$\textsf{M}_2$: $\mu_0 = 13.495$, $\gamma_0^2 = 11.382$, $\eta_0 = 1$, $\tau^2_0 = 1.182$, $\nu = 1$ y $\sigma^2_0=1.182$.

Ejecuci蚤 del modelo

```{r}
#ajustar modelo
tictoc::tic()
set.seed(1856)
cadena1_M2 <- MCMC_2(y,B = 11000, nj, yb, s2)
tictoc::toc()
```

### Convergencia

Usaremos la log-verosimilitud para mirar la convergencia de la cadena

```{r}
# cadenas
col <- RColorBrewer::brewer.pal(9,"Set1")[1:9]
yrange <- range(cadena1_M2$LL$ll)
# Gr치fico
plot(cadena1_M2$LL$ll[1001:length(cadena1_M2$LL$ll)], type = "p", pch = ".", cex = 1.1, col = col[2], ylim = yrange, xlab = "Iteraci蚤", ylab = "Log-verosimilitud", main = "Modelo 2")
```

## Modelo 3

Hiperpar炅etros del modelo.

$\textsf{M}_3$: $\mu_0 = 13.495$, $\gamma_0^2 = 11.382$, $\eta_0 = 1$, $\tau^2_0 = 1.182$, $\nu = 1$, $\alpha_0 = 1$, $\beta_0 = 0.846$.

Ejecuci蚤 del modelo

```{r}
#ajustar modelo
tictoc::tic()
set.seed(1856)
cadena1_M3 <- MCMC_3(y, B = 11000, nj, yb, s2)
tictoc::toc()
```
### Convergencia

Usaremos la log-verosimilitud para mirar la convergencia de la cadena

```{r}
# cadenas
col <- RColorBrewer::brewer.pal(9,"Set1")[1:9]
yrange <- range(cadena1_M3$LL$ll)
# Gr치fico
plot(cadena1_M3$LL$ll, type = "p", pch = ".", cex = 1.1, col = col[2], ylim = yrange, xlab = "Iteraci蚤", ylab = "Log-verosimilitud", main = "Modelo 3")
```
## Modelo 6

```{r}
#ajustar modelo
tictoc::tic()
set.seed(1856)
cadena1_M6 <- MCMC_6(y, B = 11000, nj, yb, s2)
tictoc::toc()
```

```{r}
# cadenas
col <- RColorBrewer::brewer.pal(9,"Set1")[1:9]
yrange <- range(cadena1_M6$LL$ll)
# Gr치fico
plot(cadena1_M6$LL$ll, type = "p", pch = ".", cex = 1.1, col = col[2], ylim = yrange, xlab = "Iteraci蚤", ylab = "Log-verosimilitud", main = "Modelo 6")
```







